{% style %}
  footer {
    background: url("{{ 'footer-bg.png' | asset_url }}") #132142;
    background-repeat: no-repeat;
    background-size: cover;
  }
{% endstyle %}

  <div class="container">
    <div class="top">
      <div class="form">
        <p>Join our table to receive updates, campaign stories and more</p>
        <div class="newsletter">
          {% comment %} {% form 'customer', id: 'NewsletterForm', class: 'newsletter' %}

            {%- if form.posted_successfully? -%} 
              <div role="status">
                Thankyou
              </div>
            {%- elsif form.errors -%}
              <div role="alert">
                {% for field in form.errors %}
                  {%- if field == 'email' -%}
                    Invalid Email Address
                  {%- else -%}
                    {{ form.errors.messages[field] }}
                  {%- endif -%}
                {% endfor %}
              </div>
            {% else %}
              <input type="hidden" name="contact[tags]" value="newsletter">

              <input
                id="NewsletterEmail"
                type="email"
                name="contact[email]"
                placeholder="Enter Your Email"
                required
                aria-required="true"
                autocomplete="email"
              />

              <button class="newsletter__button" type="submit">
                SEND
              </button>
            {% endif %}
          {% endform %} {% endcomment %}
          <!-- Hidden real form from Shopify -->
          <form id="HiddenNewsletterForm" action="/contact" method="post" style="display:none;">
            {% form 'customer' %}
              <input type="hidden" name="contact[tags]" value="newsletter">
            {% endform %}
          </form>

          <!-- Your visible custom form -->
          <div id="newsletter-wrapper">
            <input
              type="email"
              id="NewsletterEmail"
              placeholder="Enter your email"
              required
              aria-required="true"
              autocomplete="email"
            />
            <button id="newsletter-submit" type="button">SEND</button>
            <div id="newsletter-message"></div>
          </div>

        </div>
      </div>
      <div class="menu-group">
        {% comment %} <div class="menu">
          <div class="menu-label">[Products]</div>
          {% for link in section.settings.product_menu.links %}
            <a href="{{ link.url }}">{{ link.title }}</a>
          {% endfor %}
        </div> {% endcomment %}
        {% comment %} <div class="menu">
          <div class="menu-label">[Company]</div>
          {% for link in section.settings.company_menu.links %}
            <a href="{{ link.url }}">{{ link.title }}</a>
          {% endfor %}
        </div> {% endcomment %}
        <div class="menu">
          <div class="menu-label">[Social]</div>
          {% for link in section.settings.social_menu.links %}
            <a href="{{ link.url }}">{{ link.title }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="brand">Feenie's table</div>
    <div class="copy">
      <div> {{ section.settings.copyright }} </div>
      <div>
        <a href=""> Terms & Conditions </a>
        <a href=""> Privacy Policy </a>
      </div>
    </div>
  </div>

<script>
  document.getElementById('newsletter-submit').addEventListener('click', function(e) {
    e.preventDefault();

    var email = document.getElementById('NewsletterEmail').value;
    var messageBox = document.getElementById('newsletter-message');

    if (!email) {
      messageBox.textContent = "⚠️ Please enter your email";
      messageBox.style.color = "red";
      return;
    }

    // Build form data from hidden Shopify form
    var form = document.getElementById('HiddenNewsletterForm');
    var formData = new FormData(form);
    formData.set('contact[email]', email);

    fetch('/contact', {
      method: 'POST',
      body: formData,
    })
    .then(res => res.text())
    .then(html => {
      if (html.includes('errors')) {
        messageBox.textContent = "⚠️ Invalid email or already subscribed.";
        messageBox.style.color = "red";
      } else {
        messageBox.textContent = "✅ Thanks for subscribing!";
        messageBox.style.color = "green";
        document.getElementById('NewsletterEmail').value = '';
      }
    })
    .catch(err => {
      console.error("Error:", err);
      messageBox.textContent = "❌ Something went wrong.";
      messageBox.style.color = "red";
    });
  });
</script>


{% schema %}
{
  "name": "Footer",
  "tag": "footer",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Copyright text"
    },
    {
      "type": "text",
      "id": "copyright",
      "label": "Footer copyright text",
      "default": "© <span>2025</span> Feenie's Table. | All Rights Reserved",
      "info": "Use <span/> to show year automaticly"
    },
    {
      "type": "header",
      "content": "Footer menu"
    },
    {
      "type": "link_list",
      "id": "product_menu",
      "label": "Product menu"
    },
    {
      "type": "link_list",
      "id": "company_menu",
      "label": "Company menu"
    },
    {
      "type": "link_list",
      "id": "social_menu",
      "label": "Social menu"
    },
  ],
}
{% endschema %}
